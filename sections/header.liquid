{{ 'base-header.css' | asset_url | stylesheet_tag }}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const header = document.querySelector('header');
    const hero = document.querySelector('#hero');
    const brandLogo = document.querySelector('header svg');

    if (!header || !hero || !brandLogo) return;

    let headerHeight = 0;
    let heroHeight = 0;
    let ticking = false;
    const scrolledClass = 'el_brandLogo-scrolled';

    function updateHeroHeight() {
      heroHeight = hero.offsetHeight;
    }
    function updateHeaderHeight() {
      headerHeight = header.offsetHeight / 3;
    }

    function updateBrandLogoSize() {
      if (!ticking) {
        requestAnimationFrame(function () {
          const scrollY = window.scrollY;

          if (scrollY >= headerHeight) {
            // hero分スクロールしたら、el_brandLogo-scrolledクラスを追加
            brandLogo.classList.add(scrolledClass);
          } else {
            // hero分スクロールしていない場合は、el_brandLogo-scrolledクラスを削除
            brandLogo.classList.remove(scrolledClass);
          }

          ticking = false;
        });
        ticking = true;
      }
    }

    updateHeaderHeight();
    updateBrandLogoSize();

    window.addEventListener('scroll', updateBrandLogoSize, { passive: true });
    window.addEventListener('resize', function () {
      updateHeaderHeight();
      updateBrandLogoSize();
    });

    const observer = new ResizeObserver(function () {
      updateHeaderHeight();
      updateBrandLogoSize();
    });

    observer.observe(hero);
  });
</script>

<header class="fixed left-0 z-1000 w-screen bg-white-transparent">
  <div class="wrapper w-full flex justify-between items-center">
    <h2 class="header-logo w-[60px] md:w-[80px]">
      <a href="{{ routes.root_url }}">
        {% render 'el_brandLogo' %}
      </a>
    </h2>

    <div class="h-fit">
      <!-- デスクトップメニューは削除または非表示 -->

      <div class="header_icons">
        {% if shop.customer_accounts_enabled %}
          <div class="header_icon">
            <a href="{{ routes.account_url }}" class="flex flex-col items-center">
              {{ 'icon-account.svg' | inline_asset_content }}
              <p class="text-xxs md:text-xs">マイページ</p>
            </a>
          </div>
        {% endif %}

        <div class="header_icon">
          <a href="{{ routes.cart_url }}" class="flex flex-col items-center">
            {% if cart.item_count > 0 %}
              <sup>{{ cart.item_count }}</sup>
            {% endif %}

            {{ 'icon-cart.svg' | inline_asset_content }}
            <p class="text-xxs md:text-xs">カート</p>
          </a>
        </div>

        <!-- ハンバーガーメニューボタン -->
        <div class="header_hamburger header_icon">
          <button
            type="button"
            class="hamburger-btn flex flex-col items-center cursor-pointer bg-transparent border-none p-0"
            aria-label="メニューを開く"
            aria-expanded="false"
            aria-controls="mobile-menu-drawer"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
            <p class="text-xxs md:text-xs">メニュー</p>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- モバイルメニュードロワー -->
  <div id="mobile-menu-drawer" class="menu-drawer" aria-hidden="true">
    <div class="menu-drawer_overlay"></div>
    <div class="menu-drawer_content">
      <div class="menu-drawer_header">
        <h3>メニュー</h3>
        <button type="button" class="menu-drawer_close" aria-label="メニューを閉じる">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <nav class="menu-drawer_nav">
        <ul class="menu-drawer_list">
          {% for link in section.settings.menu.links %}
            <li class="menu-drawer_item">
              <a href="{{ link.url }}" class="menu-drawer_link">
                {{ link.title }}
              </a>
              {% if link.links != blank %}
                <ul class="menu-drawer_submenu">
                  {% for child_link in link.links %}
                    <li class="menu-drawer_subitem">
                      <a href="{{ child_link.url }}" class="menu-drawer_sublink">
                        {{ child_link.title }}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </nav>
    </div>
  </div>
</header>

<script>
  (function () {
    class MenuDrawer {
      constructor() {
        this.drawer = document.getElementById('mobile-menu-drawer');
        this.openBtn = document.querySelector('.hamburger-btn');
        this.closeBtn = document.querySelector('.menu-drawer_close');
        this.overlay = document.querySelector('.menu-drawer_overlay');

        if (this.drawer && this.openBtn) {
          this.bindEvents();
        }
      }

      bindEvents() {
        if (this.openBtn) {
          this.openBtn.addEventListener('click', () => this.open());
        }
        if (this.closeBtn) {
          this.closeBtn.addEventListener('click', () => this.close());
        }
        if (this.overlay) {
          this.overlay.addEventListener('click', () => this.close());
        }

        // ESCキーでメニューを閉じる
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.drawer.getAttribute('aria-hidden') === 'false') {
            this.close();
          }
        });
      }

      open() {
        this.drawer.setAttribute('aria-hidden', 'false');
        this.openBtn.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
      }

      close() {
        this.drawer.setAttribute('aria-hidden', 'true');
        this.openBtn.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      }
    }

    // DOMの読み込み完了後に初期化
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => new MenuDrawer());
    } else {
      new MenuDrawer();
    }
  })();
</script>

{% schema %}
{
  "name": "header",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "メニュー",
      "info": "ハンバーガーメニューに表示されるメニューを選択してください"
    }
  ]
}
{% endschema %}
